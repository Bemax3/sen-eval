import{Q as q,b as V,r as f,T as L,w as P,o as s,d as p,e as l,f as e,u as r,Z as Q,a as t,c as d,g as m,n as y,t as h,p as Z,F as D,j as M,k as b,i as G,O as U}from"./app-74a7ed68.js";import{a as x,_ as I,g as J}from"./AuthenticatedLayout-c5d98272.js";import{_ as K,a as W}from"./Title-6826ba98.js";import{_ as X}from"./Breadcrumbs-9ec19463.js";import{_ as Y}from"./Separator-6eb3fcab.js";import{_ as ee}from"./SubmitButton-a4088352.js";import{_ as ae}from"./InputError-82c353da.js";import{_ as te}from"./Datatable-1f2c6bab.js";import{_ as C,a as ie,b as j}from"./EmptyState-dc589c25.js";import{_ as se}from"./TextArea-06ba8401.js";import{_ as ne}from"./FormIndications-6eabc421.js";import{_ as R}from"./InputLabel-821b8b0a.js";import{_ as le}from"./DeleteModal-7f1b05d8.js";import{r as re}from"./ChevronUpDownIcon-7cddf03d.js";import{r as oe}from"./CheckIcon-9bf2de54.js";import{r as ue}from"./PencilSquareIcon-e64d098d.js";import{r as ce}from"./TrashIcon-7903799f.js";import{N as de,H as me,B as _e,U as ge}from"./listbox-a2068e7f.js";import"./logo1637145113-c7398df9.js";import"./ExclamationTriangleIcon-a3c8ea96.js";import"./use-controllable-8a68f84c.js";const fe={class:"px-4 sm:px-6 lg:px-8"},pe=["onSubmit"],ve=t("h3",{class:"text-base font-semibold leading-6 text-gray-900"},"Faire une réclamation",-1),ye=t("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[t("p",null,"Rechercher une réclamation et ajouter la à la liste des réclamation pour cette évaluation.")],-1),he={class:"px-4 py-6 sm:p-8"},be={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},xe={class:"col-span-full relative"},we={class:"relative"},ke={key:0,class:"block truncate"},$e={key:1,class:"block truncate"},Ve={class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2"},Ce={class:"col-span-full"},Ne={class:"mt-2"},Be={class:"flex items-center justify-between gap-x-6 border-t border-gray-900/10 px-4 py-4 sm:px-8"},Ee={key:0,class:"min-w-full divide-y divide-gray-300"},Ae={class:"bg-gray-50"},De={class:"divide-y divide-gray-200 bg-white"},Me={class:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6"},Ue={key:0,class:"flex items-center justify-center gap-2"},je=["onClick"],Re=["onClick"],Te={key:1,class:"text-center bg-white text-lg text-gray-600 py-4"},T="",sa={__name:"RatingClaims",props:{agent:{},rating:{},types:{type:Array},claims:{}},setup(o){var E;const n=o,w=q().props.auth.user,g=V(()=>w.user_id===n.rating.evaluated_id),N=V(()=>w.user_id!==n.rating.evaluated_id&&w.user_id!==n.rating.evaluator_id),F=g.value?[{name:"Mes Évaluations",href:route("ratings.index",{agent_rating:n.rating.rating_id}),current:!1},{name:"Evaluation",href:"#",current:!0}]:N?[{name:"Mes validations",href:route("validations.index"),current:!1},{name:"Évaluation",href:"#",current:!0}]:[{name:"Mes Agents",href:route("agents.index"),current:!1},{name:"Évaluations",href:route("agent-ratings.index",{agent:n.agent.user_id}),current:!1},{name:"Evaluation",href:"#",current:!0}],i=f(L({claim_type_id:x(n.types)?n.types[0].claim_type_id:null,rating_claim_comment:""})),S=V(()=>J(n.claims)),_=f(n.claims.data),B=f(),k=f(!1),$=f((E=_[0])==null?void 0:E.rating_claim_id),z=u=>{$.value=u,k.value=!0},H=u=>{const c=_.value.filter(a=>a.rating_claim_id===u)[0];i.value.rating_claim_id=u,i.value.rating_claim_comment=c.rating_claim_comment||"",i.value.claim_type_id=c.claim_type_id,B.value.focus()},O=()=>{i.value.rating_claim_id?i.value.put(route("rating-claims.update",{rating:n.rating.rating_id,rating_claim:i.value.rating_claim_id})):i.value.post(route("rating-claims.store",{rating:n.rating.rating_id}))};return P(()=>n.claims,function(u){_.value=u.data,!_.value.length>0&&(u.prev_page_url?U.get(u.prev_page_url):U.get(u.first_page_url))}),(u,c)=>(s(),p(I,null,{default:l(()=>[e(r(Q),{title:"Réclamations"}),t("div",fe,[e(X,{pages:r(F)},null,8,["pages"]),e(K,{agent:o.agent,rating:o.rating},null,8,["agent","rating"]),e(W,{agent_id:n.agent.user_id,evaluated:g.value,rating_id:n.rating.rating_id,validator:N.value},null,8,["agent_id","evaluated","rating_id","validator"]),g.value&&!o.rating.rating_is_validated?(s(),d("form",{key:0,class:"mt-8 bg-white px-4 py-5 sm:p-6 shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl md:col-span-2",onSubmit:G(O,["prevent"])},[ve,ye,t("div",he,[t("div",be,[t("div",xe,[e(R,{for:"",required:""},{default:l(()=>[m("Nature")]),_:1}),e(r(_e),{modelValue:i.value.claim_type_id,"onUpdate:modelValue":c[0]||(c[0]=a=>i.value.claim_type_id=a)},{default:l(()=>[t("div",we,[e(r(de),{class:y([i.value.errors.phase_id?"ring-red-300":"ring-gray-300","w-full cursor-default rounded-md bg-white py-1.5 pl-3 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset focus:outline-none focus:ring-2 focus:ring-cyan-700 sm:text-sm sm:leading-6"])},{default:l(()=>[r(x)(o.types)?(s(),d("span",ke,h(o.types.filter(a=>a.claim_type_id===i.value.claim_type_id)[0].claim_type_name),1)):(s(),d("span",$e,"Aucune réclamation disponible pour l'instant.")),t("span",Ve,[e(r(re),{"aria-hidden":"true",class:"h-5 w-5 text-gray-400"})])]),_:1},8,["class"]),e(Z,{"leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:l(()=>[r(x)(o.types)?(s(),p(r(me),{key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:l(()=>[(s(!0),d(D,null,M(o.types,a=>(s(),p(r(ge),{key:a.claim_type_id,value:a.claim_type_id,as:"template"},{default:l(({active:v,selected:A})=>[t("li",{class:y([v?"bg-cyan-600  text-white":"text-gray-900","relative cursor-default select-none py-2 pl-3 pr-9"])},[t("span",{class:y([A?"font-semibold":"font-normal","block truncate"])},h(a.claim_type_name),3),A?(s(),d("span",{key:0,class:y([v?"text-white":"text-cyan-600","absolute inset-y-0 right-0 flex items-center pr-4"])},[e(r(oe),{"aria-hidden":"true",class:"h-5 w-5"})],2)):b("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})):b("",!0)]),_:1})])]),_:1},8,["modelValue"]),e(ae,{message:i.value.errors.claim_type_id},null,8,["message"])]),t("div",Ce,[e(R,{for:""},{default:l(()=>[m("Commentaire")]),_:1}),t("div",Ne,[e(se,{ref_key:"input",ref:B,modelValue:i.value.rating_claim_comment,"onUpdate:modelValue":c[1]||(c[1]=a=>i.value.rating_claim_comment=a)},null,8,["modelValue"])])])])]),t("div",Be,[e(ne),e(ee,{disabled:o.rating.rating_is_validated,processing:i.value.processing,class:"mt-3 sm:ml-3 sm:mt-0 sm:w-auto",type:"submit"},{default:l(()=>[m("Enregistrer ")]),_:1},8,["disabled","processing"])])],40,pe)):b("",!0),e(Y,{title:"Réclamations"}),r(x)(o.claims.data)?(s(),p(te,{key:1,modelValue:T,"onUpdate:modelValue":c[2]||(c[2]=a=>T=a),pagination:S.value,search:!1},{default:l(()=>[_.value.length>0?(s(),d("table",Ee,[t("thead",Ae,[t("tr",null,[e(C,{first:!0},{default:l(()=>[m("Type")]),_:1}),e(C,{class:"whitespace-pre-line"},{default:l(()=>[m("Commentaire")]),_:1}),e(C)])]),t("tbody",De,[(s(!0),d(D,null,M(_.value,a=>(s(),d("tr",{key:a.rating_claim_id},[e(j,{first:!0},{default:l(()=>[m(h(a.type.claim_type_name),1)]),_:2},1024),e(j,{class:"whitespace-pre-line"},{default:l(()=>[m(h(a.rating_claim_comment||"__"),1)]),_:2},1024),t("td",Me,[g.value&&!o.rating.rating_is_validated?(s(),d("div",Ue,[t("button",{class:"rounded-lg bg-cyan-600 p-2 text-white shadow-sm hover:bg-cyan-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600",type:"button",onClick:v=>H(a.rating_claim_id)},[e(r(ue),{"aria-hidden":"true",class:"h-5 w-5"})],8,je),t("button",{class:"rounded-lg bg-red-600 p-2 text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600",type:"button",onClick:v=>z(a.rating_claim_id)},[e(r(ce),{"aria-hidden":"true",class:"h-5 w-5"})],8,Re)])):b("",!0)])]))),128))])])):(s(),d("div",Te," Aucun élément trouvé."))]),_:1},8,["pagination"])):(s(),p(ie,{key:2,message:g.value?"Demander une réclamation en utilisant la liste déroulante en haut.":"",title:"Aucune réclamation faite pour l'instant."},null,8,["message"]))]),e(le,{link:u.route("rating-claims.destroy",{rating:o.rating.rating_id,rating_claim:$.value?$.value:-1}),opened:k.value,onCloseModal:c[3]||(c[3]=a=>k.value=!1)},null,8,["link","opened"])]),_:1}))}};export{sa as default};
