import{Q as R,b as D,r as f,T as L,w as Q,o as r,d as p,e as l,f as e,u as i,Z,a,c as _,g as u,n as h,t as g,p as G,F as A,j,k as x,i as I,O as q}from"./app-74a7ed68.js";import{a as k,_ as J,g as K}from"./AuthenticatedLayout-c5d98272.js";import{_ as W,a as X}from"./Title-6826ba98.js";import{_ as Y}from"./Breadcrumbs-9ec19463.js";import{_ as ee}from"./Separator-6eb3fcab.js";import{_ as te}from"./SubmitButton-a4088352.js";import{_ as P}from"./InputError-82c353da.js";import{_ as ie}from"./Datatable-1f2c6bab.js";import{_ as y,a as ae,b as w}from"./EmptyState-dc589c25.js";import{_ as N}from"./InputLabel-821b8b0a.js";import{_ as se}from"./TextInput-3acfc4d0.js";import{_ as le}from"./FormIndications-6eabc421.js";import{_ as ne}from"./TextArea-06ba8401.js";import{_ as re}from"./DeleteModal-7f1b05d8.js";import{r as oe}from"./ChevronUpDownIcon-7cddf03d.js";import{r as de}from"./CheckIcon-9bf2de54.js";import{r as ue}from"./PencilSquareIcon-e64d098d.js";import{r as me}from"./TrashIcon-7903799f.js";import{N as _e,H as ce,B as ge,U as fe}from"./listbox-a2068e7f.js";import"./logo1637145113-c7398df9.js";import"./ExclamationTriangleIcon-a3c8ea96.js";import"./use-controllable-8a68f84c.js";const pe={class:"px-4 sm:px-6 lg:px-8"},ye=["onSubmit"],be=a("h3",{class:"text-base font-semibold leading-6 text-gray-900"},"Demander une mobilité",-1),ve=a("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[a("p",null,"Rechercher une mobilité et ajouter la à la liste des demandes pour cette évaluation. ")],-1),he={class:"px-4 py-6 sm:p-8"},xe={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},ke={class:"col-span-full"},we={class:"mt-2"},$e={class:"flex flex-col space-y-2"},Ve={class:"col-span-full"},Ce={class:"mt-2"},Me={class:"col-span-full relative"},De={class:"relative"},Ne={key:0,class:"block truncate"},Ue={key:1,class:"block truncate"},Be={class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2"},Ee={class:"flex items-center justify-between gap-x-6 border-t border-gray-900/10 px-4 py-4 sm:px-8"},Ae={key:0,class:"min-w-full divide-y divide-gray-300"},je={class:"bg-gray-50"},qe={class:"divide-y divide-gray-200 bg-white"},Pe={class:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6"},Se={key:0,class:"flex items-center justify-center space-x-2"},Te=["onClick"],ze=["onClick"],Fe={key:1,class:"text-center bg-white text-lg text-gray-600 py-4"},S="",dt={__name:"RatingMobilities",props:{agent:{},rating:{},types:{type:Array},mobilities:{}},setup(d){var B;const o=d,b=R().props.auth.user,$=D(()=>b.user_id===o.rating.evaluated_id),V=D(()=>b.user_id!==o.rating.evaluated_id&&b.user_id!==o.rating.evaluator_id),T=$.value?[{name:"Mes Évaluations",href:route("ratings.index",{agent_rating:o.rating.rating_id}),current:!1},{name:"Evaluation",href:"#",current:!0}]:V?[{name:"Mes validations",href:route("validations.index"),current:!1},{name:"Évaluation",href:"#",current:!0}]:[{name:"Mes Agents",href:route("agents.index"),current:!1},{name:"Évaluations",href:route("agent-ratings.index",{agent:o.agent.user_id}),current:!1},{name:"Evaluation",href:"#",current:!0}],z=D(()=>K(o.mobilities)),c=f(o.mobilities.data),U=f(null);let s=f(L({rating_mobility_title:"",rating_mobility_comment:"",mobility_type_id:k(o.types)?o.types[0].mobility_type_id:null}));const C=f(!1),M=f((B=c[0])==null?void 0:B.rating_mobility_id),F=m=>{M.value=m,C.value=!0},H=m=>{const n=c.value.filter(t=>t.rating_mobility_id===m)[0];$?s.value.asked_by_evaluated=n.asked_by_evaluated:s.value.asked_by_evaluator=n.asked_by_evaluator,s.value.rating_mobility_id=m,s.value.rating_mobility_title=n.rating_mobility_title,s.value.rating_mobility_comment=n.rating_mobility_comment,s.value.mobility_type_id=n.mobility_type_id,U.value.focus()},O=()=>{s.value.rating_mobility_id?s.value.put(route("rating-mobilities.update",{rating:o.rating.rating_id,rating_mobility:s.value.rating_mobility_id})):s.value.post(route("rating-mobilities.store",{rating:o.rating.rating_id}))};return Q(()=>o.mobilities,function(m){c.value=m.data,!c.value.length>0&&(m.prev_page_url?q.get(m.prev_page_url):q.get(m.first_page_url))}),(m,n)=>(r(),p(J,null,{default:l(()=>[e(i(Z),{title:"Mobilités"}),a("div",pe,[e(Y,{pages:i(T)},null,8,["pages"]),e(W,{agent:d.agent,rating:d.rating},null,8,["agent","rating"]),e(X,{agent_id:o.agent.user_id,evaluated:$.value,rating_id:o.rating.rating_id,validator:V.value},null,8,["agent_id","evaluated","rating_id","validator"]),!V.value&&!d.rating.rating_is_validated?(r(),_("form",{key:0,class:"mt-8 bg-white px-4 py-5 sm:p-6 shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl md:col-span-2",onSubmit:I(O,["prevent"])},[be,ve,a("div",he,[a("div",xe,[a("div",ke,[e(N,{for:"",required:""},{default:l(()=>[u("Poste")]),_:1}),a("div",we,[e(se,{ref_key:"input",ref:U,modelValue:i(s).rating_mobility_title,"onUpdate:modelValue":n[0]||(n[0]=t=>i(s).rating_mobility_title=t),invalid:i(s).errors.rating_mobility_title!==void 0},null,8,["modelValue","invalid"])]),a("div",$e,[e(P,{message:i(s).errors.rating_mobility_title},null,8,["message"])])]),a("div",Ve,[e(N,{required:""},{default:l(()=>[u("Commentaire")]),_:1}),a("div",Ce,[e(ne,{modelValue:i(s).rating_mobility_comment,"onUpdate:modelValue":n[1]||(n[1]=t=>i(s).rating_mobility_comment=t)},null,8,["modelValue"])])]),a("div",Me,[e(N,{for:"",required:""},{default:l(()=>[u("Nature")]),_:1}),e(i(ge),{modelValue:i(s).mobility_type_id,"onUpdate:modelValue":n[2]||(n[2]=t=>i(s).mobility_type_id=t)},{default:l(()=>[a("div",De,[e(i(_e),{class:h([i(s).errors.phase_id?"ring-red-300":"ring-gray-300","w-full cursor-default rounded-md bg-white py-1.5 pl-3 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset focus:outline-none focus:ring-2 focus:ring-cyan-700 sm:text-sm sm:leading-6"])},{default:l(()=>[i(k)(d.types)?(r(),_("span",Ne,g(d.types.filter(t=>t.mobility_type_id===i(s).mobility_type_id)[0].mobility_type_name),1)):(r(),_("span",Ue,"Aucune Mobilité disponible pour l'instant.")),a("span",Be,[e(i(oe),{"aria-hidden":"true",class:"h-5 w-5 text-gray-400"})])]),_:1},8,["class"]),e(G,{"leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:l(()=>[i(k)(d.types)?(r(),p(i(ce),{key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:l(()=>[(r(!0),_(A,null,j(d.types,t=>(r(),p(i(fe),{key:t.mobility_type_id,value:t.mobility_type_id,as:"template"},{default:l(({active:v,selected:E})=>[a("li",{class:h([v?"bg-cyan-600  text-white":"text-gray-900","relative cursor-default select-none py-2 pl-3 pr-9"])},[a("span",{class:h([E?"font-semibold":"font-normal","block truncate"])},g(t.mobility_type_name),3),E?(r(),_("span",{key:0,class:h([v?"text-white":"text-cyan-600","absolute inset-y-0 right-0 flex items-center pr-4"])},[e(i(de),{"aria-hidden":"true",class:"h-5 w-5"})],2)):x("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})):x("",!0)]),_:1})])]),_:1},8,["modelValue"])]),e(P,{message:i(s).errors.mobility_type_id},null,8,["message"])])]),a("div",Ee,[e(le),e(te,{disabled:d.rating.rating_is_validated,processing:i(s).processing,class:"mt-3 sm:ml-3 sm:mt-0 sm:w-auto",type:"submit"},{default:l(()=>[u("Enregistrer ")]),_:1},8,["disabled","processing"])])],40,ye)):x("",!0),e(ee,{title:"Mobilités Demandées"}),i(k)(d.mobilities.data)?(r(),p(ie,{key:1,modelValue:S,"onUpdate:modelValue":n[3]||(n[3]=t=>S=t),pagination:z.value,search:!1},{default:l(()=>[c.value.length>0?(r(),_("table",Ae,[a("thead",je,[a("tr",null,[e(y,{first:!0},{default:l(()=>[u("Nature")]),_:1}),e(y,null,{default:l(()=>[u("Demandée par")]),_:1}),e(y,null,{default:l(()=>[u("Poste demandé")]),_:1}),e(y,{class:"whitespace-pre-line"},{default:l(()=>[u("Commentaire")]),_:1}),e(y)])]),a("tbody",qe,[(r(!0),_(A,null,j(c.value,t=>(r(),_("tr",{key:t.rating_mobility_id},[e(w,{first:!0,class:"whitespace-pre-line"},{default:l(()=>[u(g(t.type.mobility_type_name),1)]),_:2},1024),e(w,null,{default:l(()=>[u(g(t.asked_by?t.asked_by.user_display_name:"Unknown"),1)]),_:2},1024),e(w,null,{default:l(()=>[u(g(t.rating_mobility_title),1)]),_:2},1024),e(w,{class:"whitespace-pre-line"},{default:l(()=>[u(g(t.rating_mobility_comment),1)]),_:2},1024),a("td",Pe,[!d.rating.rating_is_validated&&t.asked_by&&i(b).user_id===t.asked_by.user_id?(r(),_("div",Se,[a("button",{class:"rounded-lg bg-cyan-600 p-2 text-white shadow-sm hover:bg-cyan-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600",type:"button",onClick:v=>H(t.rating_mobility_id)},[e(i(ue),{"aria-hidden":"true",class:"h-5 w-5"})],8,Te),a("button",{class:"rounded-lg bg-red-600 p-2 text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600",type:"button",onClick:v=>F(t.rating_mobility_id)},[e(i(me),{"aria-hidden":"true",class:"h-5 w-5"})],8,ze)])):x("",!0)])]))),128))])])):(r(),_("div",Fe," Aucun élément trouvé."))]),_:1},8,["pagination"])):(r(),p(ae,{key:2,message:"Demander une mobilité en utilisant le formulaire en haut.",title:"Aucune mobilité demandée pour l'instant."}))]),e(re,{link:m.route("rating-mobilities.destroy",{rating:d.rating.rating_id,rating_mobility:M.value?M.value:-1}),opened:C.value,onCloseModal:n[4]||(n[4]=t=>C.value=!1)},null,8,["link","opened"])]),_:1}))}};export{dt as default};
