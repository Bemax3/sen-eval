import{Q as O,b as N,r as f,T as q,w as G,o as r,d as v,e as s,f as e,u as a,Z as Q,a as t,c as m,t as _,P as B,g as c,n as y,p as Z,F as E,j as U,k as w,i as I,O as P}from"./app-74a7ed68.js";import{a as k,_ as J,g as K,m as j}from"./AuthenticatedLayout-c5d98272.js";import{_ as W,a as X}from"./Title-6826ba98.js";import{_ as ee}from"./Breadcrumbs-9ec19463.js";import{_ as te}from"./Separator-6eb3fcab.js";import{_ as ae}from"./SubmitButton-a4088352.js";import{_ as ie}from"./InputError-82c353da.js";import{_ as ne}from"./Datatable-1f2c6bab.js";import{_ as h,a as se,b as $}from"./EmptyState-dc589c25.js";import{_ as z}from"./InputLabel-821b8b0a.js";import{_ as oe}from"./FormIndications-6eabc421.js";import{_ as re}from"./Switch-831a0af4.js";import{_ as le}from"./TextArea-06ba8401.js";import{_ as ue}from"./DeleteModal-7f1b05d8.js";import{r as de}from"./ChevronUpDownIcon-7cddf03d.js";import{r as me}from"./CheckIcon-9bf2de54.js";import{r as _e}from"./PencilSquareIcon-e64d098d.js";import{r as ce}from"./TrashIcon-7903799f.js";import{N as ge,H as pe,B as fe,U as ve}from"./listbox-a2068e7f.js";import"./logo1637145113-c7398df9.js";import"./switch-20b94d42.js";import"./use-controllable-8a68f84c.js";import"./ExclamationTriangleIcon-a3c8ea96.js";const ye={class:"px-4 sm:px-6 lg:px-8"},he=["onSubmit"],be=t("h3",{class:"text-base font-semibold leading-6 text-gray-900"},"Demander une promotion ou un avancement",-1),xe=t("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[t("p",null,"Rechercher une promotion ou un avancement et ajouter la à la liste des demandes pour cette évaluation. ")],-1),we={class:"mt-2 max-w-xl text-sm text-gray-500"},ke={class:"mt-2 max-w-xl text-sm text-gray-500"},$e={class:"px-4 py-6 sm:p-8"},Ve={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},Me={class:"col-span-full"},De={class:"mt-2"},Ne={class:"col-span-full relative"},Ce={class:"relative"},Ye={key:0,class:"block truncate"},Ae={key:1,class:"block truncate"},Be={class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2"},Ee={class:"col-span-full"},Ue={class:"mt-2"},Pe={class:"flex items-center justify-between gap-x-6 border-t border-gray-900/10 px-4 py-4 sm:px-8"},je={key:0,class:"min-w-full divide-y divide-gray-300"},ze={class:"bg-gray-50"},Fe={class:"divide-y divide-gray-200 bg-white"},Re={class:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6"},Se={key:0,class:"flex items-center justify-center gap-2"},Te=["onClick"],He=["onClick"],Le={key:1,class:"text-center bg-white text-lg text-gray-600 py-4"},F="",ct={__name:"RatingPromotions",props:{agent:{},rating:{},types:{type:Array},promotions:{}},setup(o){var Y;const l=o,V=O().props.auth.user,p=N(()=>V.user_id===l.rating.evaluated_id),b=N(()=>V.user_id!==l.rating.evaluated_id&&V.user_id!==l.rating.evaluator_id),R=p.value?[{name:"Mes Évaluations",href:route("ratings.index",{agent_rating:l.rating.rating_id}),current:!1},{name:"Evaluation",href:"#",current:!0}]:b?[{name:"Mes validations",href:route("validations.index"),current:!1},{name:"Évaluation",href:"#",current:!0}]:[{name:"Mes Agents",href:route("agents.index"),current:!1},{name:"Évaluations",href:route("agent-ratings.index",{agent:l.agent.user_id}),current:!1},{name:"Evaluation",href:"#",current:!0}],S=N(()=>K(l.promotions)),g=f(l.promotions.data);let n=f(q({evaluated_is_eligible:0,rating_promotion_comment:"",promotion_type_id:k(l.types)?l.types[0].promotion_type_id:null}));const C=f(),M=f(!1),D=f((Y=g[0])==null?void 0:Y.rating_mobility_id),T=d=>{D.value=d,M.value=!0},H=d=>{const u=g.value.filter(i=>i.rating_promotion_id===d)[0];n.value.rating_promotion_id=d,n.value.evaluated_is_eligible=u.evaluated_is_eligible,n.value.rating_promotion_comment=u.rating_promotion_comment,n.value.promotion_type_id=u.promotion_type_id,C.value.focus()},L=()=>{n.value.rating_promotion_id?n.value.put(route("rating-promotions.update",{rating:l.rating.rating_id,rating_promotion:n.value.rating_promotion_id})):n.value.post(route("rating-promotions.store",{rating:l.rating.rating_id}))};return G(()=>l.promotions,function(d){g.value=d.data,!g.value.length>0&&(d.prev_page_url?P.get(d.prev_page_url):P.get(d.first_page_url))}),(d,u)=>(r(),v(J,null,{default:s(()=>[e(a(Q),{title:"Promotion"}),t("div",ye,[e(ee,{pages:a(R)},null,8,["pages"]),e(W,{agent:o.agent,rating:o.rating},null,8,["agent","rating"]),e(X,{agent_id:l.agent.user_id,evaluated:p.value,rating_id:l.rating.rating_id,validator:b.value},null,8,["agent_id","evaluated","rating_id","validator"]),!p.value&&!b.value&&!o.rating.rating_is_validated?(r(),m("form",{key:0,class:"mt-8 bg-white px-4 py-5 sm:p-6 shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl md:col-span-2",onSubmit:I(L,["prevent"])},[be,xe,t("div",we,[t("p",null,"GF: "+_(o.agent.user_gf)+" promu le "+_(B(a(j)(o.agent.user_gf_prom_date).format("DD MMMM YYYY"))),1)]),t("div",ke,[t("p",null,"NR: "+_(o.agent.user_nr)+" promu le "+_(B(a(j)(o.agent.user_nr_prom_date).format("DD MMMM YYYY"))),1)]),t("div",$e,[t("div",Ve,[t("div",Me,[t("div",De,[e(re,{modelValue:a(n).evaluated_is_eligible,"onUpdate:modelValue":u[0]||(u[0]=i=>a(n).evaluated_is_eligible=i),desc:"L'évalué est-il éligible à cette avancement ou promotion ?",label:"Non Éligible / Éligible"},null,8,["modelValue"])])]),t("div",Ne,[e(z,{for:"start_date",required:""},{default:s(()=>[c("Nature")]),_:1}),e(a(fe),{modelValue:a(n).promotion_type_id,"onUpdate:modelValue":u[1]||(u[1]=i=>a(n).promotion_type_id=i)},{default:s(()=>[t("div",Ce,[e(a(ge),{class:y([a(n).errors.phase_id?"ring-red-300":"ring-gray-300","w-full cursor-default rounded-md bg-white py-1.5 pl-3 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset focus:outline-none focus:ring-2 focus:ring-cyan-700 sm:text-sm sm:leading-6"])},{default:s(()=>[a(k)(o.types)?(r(),m("span",Ye,_(o.types.filter(i=>i.promotion_type_id===a(n).promotion_type_id)[0].promotion_type_name),1)):(r(),m("span",Ae,"Aucune promotion disponible pour l'instant.")),t("span",Be,[e(a(de),{"aria-hidden":"true",class:"h-5 w-5 text-gray-400"})])]),_:1},8,["class"]),e(Z,{"leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:s(()=>[a(k)(o.types)?(r(),v(a(pe),{key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:s(()=>[(r(!0),m(E,null,U(o.types,i=>(r(),v(a(ve),{key:i.promotion_type_id,value:i.promotion_type_id,as:"template"},{default:s(({active:x,selected:A})=>[t("li",{class:y([x?"bg-cyan-600  text-white":"text-gray-900","relative cursor-default select-none py-2 pl-3 pr-9"])},[t("span",{class:y([A?"font-semibold":"font-normal","block truncate"])},_(i.promotion_type_name),3),A?(r(),m("span",{key:0,class:y([x?"text-white":"text-cyan-600","absolute inset-y-0 right-0 flex items-center pr-4"])},[e(a(me),{"aria-hidden":"true",class:"h-5 w-5"})],2)):w("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})):w("",!0)]),_:1})])]),_:1},8,["modelValue"]),e(ie,{message:a(n).errors.promotion_type_id},null,8,["message"])]),t("div",Ee,[e(z,{for:""},{default:s(()=>[c("Commentaire")]),_:1}),t("div",Ue,[e(le,{ref_key:"input",ref:C,modelValue:a(n).rating_promotion_comment,"onUpdate:modelValue":u[2]||(u[2]=i=>a(n).rating_promotion_comment=i)},null,8,["modelValue"])])])])]),t("div",Pe,[e(oe),e(ae,{disabled:o.rating.rating_is_validated,processing:a(n).processing,class:"mt-3 sm:ml-3 sm:mt-0 sm:w-auto",type:"submit"},{default:s(()=>[c("Enregistrer ")]),_:1},8,["disabled","processing"])])],40,he)):w("",!0),e(te,{title:"Promotions / Avancements Demandées"}),a(k)(o.promotions.data)?(r(),v(ne,{key:1,modelValue:F,"onUpdate:modelValue":u[3]||(u[3]=i=>F=i),pagination:S.value,search:!1},{default:s(()=>[g.value.length>0?(r(),m("table",je,[t("thead",ze,[t("tr",null,[e(h,{first:!0},{default:s(()=>[c("Nature")]),_:1}),e(h,null,{default:s(()=>[c("Demandée par")]),_:1}),e(h,null,{default:s(()=>[c("Éligibilité")]),_:1}),e(h,{class:"whitespace-pre-line"},{default:s(()=>[c("Commentaire")]),_:1}),e(h)])]),t("tbody",Fe,[(r(!0),m(E,null,U(g.value,i=>(r(),m("tr",{key:i.rating_promotion_id},[e($,{first:!0,class:"whitespace-pre-line"},{default:s(()=>[c(_(i.type.promotion_type_name),1)]),_:2},1024),e($,null,{default:s(()=>[c(_(o.rating.evaluator.user_display_name),1)]),_:1}),e($,null,{default:s(()=>[t("span",{class:y([i.evaluated_is_eligible?"bg-green-50 text-green-700 ring-green-600/20":"bg-red-50 text-red-700 ring-red-600/20","inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset"])},_(i.evaluated_is_eligible?"Éligible":"Non Éligible"),3)]),_:2},1024),e($,{class:"whitespace-pre-line"},{default:s(()=>[c(_(i.rating_promotion_comment),1)]),_:2},1024),t("td",Re,[!p.value&&!b.value&&!o.rating.rating_is_validated?(r(),m("div",Se,[t("button",{class:"rounded-lg bg-cyan-600 p-2 text-white shadow-sm hover:bg-cyan-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600",type:"button",onClick:x=>H(i.rating_promotion_id)},[e(a(_e),{"aria-hidden":"true",class:"h-5 w-5"})],8,Te),t("button",{class:"rounded-lg bg-red-600 p-2 text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600",type:"button",onClick:x=>T(i.rating_promotion_id)},[e(a(ce),{"aria-hidden":"true",class:"h-5 w-5"})],8,He)])):w("",!0)])]))),128))])])):(r(),m("div",Le," Aucun élément trouvé."))]),_:1},8,["pagination"])):(r(),v(se,{key:2,message:p.value?"":"Demander une promotion en utilisant le formulaire en haut.",title:"Aucune promotions ou avancement demandée pour l'instant."},null,8,["message"]))]),e(ue,{link:d.route("rating-promotions.destroy",{rating:o.rating.rating_id,rating_promotion:D.value?D.value:-1}),opened:M.value,onCloseModal:u[4]||(u[4]=i=>M.value=!1)},null,8,["link","opened"])]),_:1}))}};export{ct as default};
