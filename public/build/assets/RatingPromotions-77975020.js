import{Q as S,b as V,r as M,T,w as H,o as r,e as f,f as n,g as e,u as a,Z as L,a as t,c as d,t as m,P as Y,k as _,n as v,p as O,F as A,i as B,j as x,h as q,O as D}from"./app-85fecfce.js";import{h as w,_ as G,g as Q,m as E}from"./AuthenticatedLayout-33b88696.js";import{_ as Z,a as I}from"./Title-d7d47009.js";import{_ as J}from"./Breadcrumbs-4927dda0.js";import{_ as K}from"./Separator-b4eabf35.js";import{_ as W}from"./SubmitButton-78d2e83f.js";import{_ as X}from"./InputError-a19c1778.js";import{_ as ee}from"./Datatable-9fd4742e.js";import{_ as te}from"./EmptyState-3e6b0729.js";import{_ as y,a as k}from"./TableData-75c0753e.js";import{_ as U}from"./InputLabel-e5ba497b.js";import{_ as ae}from"./FormIndications-bed34787.js";import{_ as ie}from"./Switch-d2861d97.js";import{_ as se}from"./TextArea-e1fce75e.js";import{r as ne}from"./ChevronUpDownIcon-226cc4e2.js";import{r as oe}from"./CheckIcon-c05fb05a.js";import{r as re}from"./PencilSquareIcon-20fd3152.js";import{r as le}from"./TrashIcon-e8a6a5a5.js";import{N as ue,H as de,B as me,U as _e}from"./listbox-1dfbff28.js";import"./logo1637145113-c7398df9.js";import"./switch-39f9d951.js";import"./use-controllable-d8497fa4.js";const ce={class:"px-4 sm:px-6 lg:px-8"},ge=["onSubmit"],pe=t("h3",{class:"text-base font-semibold leading-6 text-gray-900"},"Demander une promotion ou un avancement",-1),fe=t("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[t("p",null,"Rechercher une promotion ou un avancement et ajouter la à la liste des demandes pour cette évaluation. ")],-1),ve={class:"mt-2 max-w-xl text-sm text-gray-500"},ye={class:"mt-2 max-w-xl text-sm text-gray-500"},he={class:"px-4 py-6 sm:p-8"},be={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},xe={class:"col-span-full"},we={class:"mt-2"},ke={class:"col-span-full relative"},$e={class:"relative"},Ve={key:0,class:"block truncate"},Me={key:1,class:"block truncate"},De={class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2"},Ne={class:"col-span-full"},Ce={class:"mt-2"},Ye={class:"flex items-center justify-between gap-x-6 border-t border-gray-900/10 px-4 py-4 sm:px-8"},Ae={key:0,class:"min-w-full divide-y divide-gray-300"},Be={class:"bg-gray-50"},Ee={class:"divide-y divide-gray-200 bg-white"},Ue={class:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6"},Pe={key:0,class:"flex items-center justify-center gap-2"},je=["onClick"],ze=["onClick"],Fe={key:1,class:"text-center bg-white text-lg text-gray-600 py-4"},P="",rt={__name:"RatingPromotions",props:{agent:{},rating:{},types:{type:Array},promotions:{}},setup(o){const l=o,$=S().props.auth.user,g=V(()=>$.user_id===l.rating.evaluated_id),h=V(()=>$.user_id!==l.rating.evaluated_id&&$.user_id!==l.rating.evaluator_id),j=g.value?[{name:"Mes Évaluations",href:route("ratings.index",{agent_rating:l.rating.rating_id}),current:!1},{name:"Evaluation",href:"#",current:!0}]:h?[{name:"Mes validations",href:route("validations.index"),current:!1},{name:"Évaluation",href:"#",current:!0}]:[{name:"Mes Agents",href:route("agents.index"),current:!1},{name:"Évaluations",href:route("agent-ratings.index",{agent:l.agent.user_id}),current:!1},{name:"Evaluation",href:"#",current:!0}],z=V(()=>Q(l.promotions)),p=M(l.promotions.data);let s=M(T({evaluated_is_eligible:0,rating_promotion_comment:"",promotion_type_id:w(l.types)?l.types[0].promotion_type_id:null}));const N=M(),F=c=>{const u=p.value.filter(i=>i.rating_promotion_id===c)[0];s.value.rating_promotion_id=c,s.value.evaluated_is_eligible=u.evaluated_is_eligible,s.value.rating_promotion_comment=u.rating_promotion_comment,s.value.promotion_type_id=u.promotion_type_id,N.value.focus()},R=()=>{s.value.rating_promotion_id?s.value.put(route("rating-promotions.update",{rating:l.rating.rating_id,rating_promotion:s.value.rating_promotion_id})):s.value.post(route("rating-promotions.store",{rating:l.rating.rating_id}))};return H(()=>l.promotions,function(c){p.value=c.data,!p.value.length>0&&(c.prev_page_url?D.get(c.prev_page_url):D.get(c.first_page_url))}),(c,u)=>(r(),f(G,null,{default:n(()=>[e(a(L),{title:"Promotion"}),t("div",ce,[e(J,{pages:a(j)},null,8,["pages"]),e(Z,{agent:o.agent,rating:o.rating},null,8,["agent","rating"]),e(I,{agent_id:l.agent.user_id,evaluated:g.value,rating_id:l.rating.rating_id,validator:h.value},null,8,["agent_id","evaluated","rating_id","validator"]),!g.value&&!h.value&&!o.rating.rating_is_validated?(r(),d("form",{key:0,class:"mt-8 bg-white px-4 py-5 sm:p-6 shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl md:col-span-2",onSubmit:q(R,["prevent"])},[pe,fe,t("div",ve,[t("p",null,"GF: "+m(o.agent.user_gf)+" promu le "+m(Y(a(E)(o.agent.user_gf_prom_date).format("DD MMMM YYYY"))),1)]),t("div",ye,[t("p",null,"NR: "+m(o.agent.user_nr)+" promu le "+m(Y(a(E)(o.agent.user_nr_prom_date).format("DD MMMM YYYY"))),1)]),t("div",he,[t("div",be,[t("div",xe,[t("div",we,[e(ie,{modelValue:a(s).evaluated_is_eligible,"onUpdate:modelValue":u[0]||(u[0]=i=>a(s).evaluated_is_eligible=i),desc:"L'évalué est-il éligible à cette avancement ou promotion ?",label:"Non Éligible / Éligible"},null,8,["modelValue"])])]),t("div",ke,[e(U,{for:"start_date",required:""},{default:n(()=>[_("Nature")]),_:1}),e(a(me),{modelValue:a(s).promotion_type_id,"onUpdate:modelValue":u[1]||(u[1]=i=>a(s).promotion_type_id=i)},{default:n(()=>[t("div",$e,[e(a(ue),{class:v([a(s).errors.phase_id?"ring-red-300":"ring-gray-300","w-full cursor-default rounded-md bg-white py-1.5 pl-3 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset focus:outline-none focus:ring-2 focus:ring-cyan-700 sm:text-sm sm:leading-6"])},{default:n(()=>[a(w)(o.types)?(r(),d("span",Ve,m(o.types.filter(i=>i.promotion_type_id===a(s).promotion_type_id)[0].promotion_type_name),1)):(r(),d("span",Me,"Aucune promotion disponible pour l'instant.")),t("span",De,[e(a(ne),{"aria-hidden":"true",class:"h-5 w-5 text-gray-400"})])]),_:1},8,["class"]),e(O,{"leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:n(()=>[a(w)(o.types)?(r(),f(a(de),{key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:n(()=>[(r(!0),d(A,null,B(o.types,i=>(r(),f(a(_e),{key:i.promotion_type_id,value:i.promotion_type_id,as:"template"},{default:n(({active:b,selected:C})=>[t("li",{class:v([b?"bg-cyan-600  text-white":"text-gray-900","relative cursor-default select-none py-2 pl-3 pr-9"])},[t("span",{class:v([C?"font-semibold":"font-normal","block truncate"])},m(i.promotion_type_name),3),C?(r(),d("span",{key:0,class:v([b?"text-white":"text-cyan-600","absolute inset-y-0 right-0 flex items-center pr-4"])},[e(a(oe),{"aria-hidden":"true",class:"h-5 w-5"})],2)):x("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})):x("",!0)]),_:1})])]),_:1},8,["modelValue"]),e(X,{message:a(s).errors.promotion_type_id},null,8,["message"])]),t("div",Ne,[e(U,{for:""},{default:n(()=>[_("Commentaire")]),_:1}),t("div",Ce,[e(se,{ref_key:"input",ref:N,modelValue:a(s).rating_promotion_comment,"onUpdate:modelValue":u[2]||(u[2]=i=>a(s).rating_promotion_comment=i)},null,8,["modelValue"])])])])]),t("div",Ye,[e(ae),e(W,{disabled:o.rating.rating_is_validated,processing:a(s).processing,class:"mt-3 sm:ml-3 sm:mt-0 sm:w-auto",type:"submit"},{default:n(()=>[_("Enregistrer ")]),_:1},8,["disabled","processing"])])],40,ge)):x("",!0),e(K,{title:"Promotions / Avancements Demandées"}),a(w)(o.promotions.data)?(r(),f(ee,{key:1,modelValue:P,"onUpdate:modelValue":u[3]||(u[3]=i=>P=i),pagination:z.value,search:!1},{default:n(()=>[p.value.length>0?(r(),d("table",Ae,[t("thead",Be,[t("tr",null,[e(y,{first:!0},{default:n(()=>[_("Nature")]),_:1}),e(y,null,{default:n(()=>[_("Demandée par")]),_:1}),e(y,null,{default:n(()=>[_("Éligibilité")]),_:1}),e(y,{class:"whitespace-pre-line"},{default:n(()=>[_("Commentaire")]),_:1}),e(y)])]),t("tbody",Ee,[(r(!0),d(A,null,B(p.value,i=>(r(),d("tr",{key:i.rating_promotion_id},[e(k,{first:!0,class:"whitespace-pre-line"},{default:n(()=>[_(m(i.type.promotion_type_name),1)]),_:2},1024),e(k,null,{default:n(()=>[_(m(o.rating.evaluator.user_display_name),1)]),_:1}),e(k,null,{default:n(()=>[t("span",{class:v([i.evaluated_is_eligible?"bg-green-50 text-green-700 ring-green-600/20":"bg-red-50 text-red-700 ring-red-600/20","inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ring-1 ring-inset"])},m(i.evaluated_is_eligible?"Éligible":"Non Éligible"),3)]),_:2},1024),e(k,{class:"whitespace-pre-line"},{default:n(()=>[_(m(i.rating_promotion_comment),1)]),_:2},1024),t("td",Ue,[!g.value&&!h.value&&!o.rating.rating_is_validated?(r(),d("div",Pe,[t("button",{class:"rounded-lg bg-cyan-600 p-2 text-white shadow-sm hover:bg-cyan-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600",type:"button",onClick:b=>F(i.rating_promotion_id)},[e(a(re),{"aria-hidden":"true",class:"h-5 w-5"})],8,je),t("button",{class:"rounded-lg bg-red-600 p-2 text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600",type:"button",onClick:b=>a(D).delete(c.route("rating-promotions.destroy",{rating:o.rating.rating_id,rating_promotion:i.rating_promotion_id}))},[e(a(le),{"aria-hidden":"true",class:"h-5 w-5"})],8,ze)])):x("",!0)])]))),128))])])):(r(),d("div",Fe," Aucun élément trouvé."))]),_:1},8,["pagination"])):(r(),f(te,{key:2,message:g.value?"":"Demander une promotion en utilisant le formulaire en haut.",title:"Aucune promotions ou avancement demandée pour l'instant."},null,8,["message"]))])]),_:1}))}};export{rt as default};
