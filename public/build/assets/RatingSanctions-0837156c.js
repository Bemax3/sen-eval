import{Q as F,b as $,r as V,T as H,w as O,o as i,e as f,f as s,g as e,u as o,Z as P,a as t,c as u,k as _,n as h,t as p,p as R,F as E,i as A,j as b,h as q,O as C}from"./app-8902e07e.js";import{h as x,_ as L,g as Q}from"./AuthenticatedLayout-dacbcdc5.js";import{_ as Z,a as G}from"./Title-641ceb08.js";import{_ as I}from"./Breadcrumbs-066f3f96.js";import{_ as J}from"./Separator-f9f18da0.js";import{_ as K}from"./SubmitButton-825b5714.js";import{_ as W}from"./InputError-eeaee326.js";import{_ as X}from"./Datatable-0200d130.js";import{_ as Y}from"./EmptyState-ad6b3eba.js";import{_ as w,a as D}from"./TableData-34a8100c.js";import{_ as ee}from"./TextArea-6b4b847b.js";import{_ as te}from"./FormIndications-26a748c1.js";import{_ as S}from"./InputLabel-7282d2f5.js";import{r as ae}from"./ChevronUpDownIcon-e1648cfe.js";import{r as se}from"./CheckIcon-e4635f0c.js";import{r as ne}from"./PencilSquareIcon-33ec4bd9.js";import{r as ie}from"./TrashIcon-ed22962e.js";import{N as re,H as oe,B as le,U as ue}from"./listbox-609832c4.js";import"./logo1637145113-11387d37.js";import"./use-controllable-83b8ecc2.js";const ce={class:"px-4 sm:px-6 lg:px-8"},de=["onSubmit"],_e=t("h3",{class:"text-base font-semibold leading-6 text-gray-900"},"Donner une sanction",-1),me=t("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[t("p",null,"Rechercher une sanction et ajouter la à la liste des sanction pour cette évaluation.")],-1),ge={class:"px-4 py-6 sm:p-8"},fe={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},pe={class:"col-span-full relative"},ve={class:"relative"},ye={key:0,class:"block truncate"},he={key:1,class:"block truncate"},be={class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2"},xe={class:"col-span-full"},we={class:"mt-2"},ke={class:"flex items-center justify-between gap-x-6 border-t border-gray-900/10 px-4 py-4 sm:px-8"},$e={key:0,class:"min-w-full divide-y divide-gray-300"},Ve={class:"bg-gray-50"},Ce={class:"divide-y divide-gray-200 bg-white"},De={class:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6"},Ne={key:0,class:"flex items-center justify-center gap-2"},Be=["onClick"],Ee=["onClick"],Ae={key:1,class:"text-center bg-white text-lg text-gray-600 py-4"},U="",Xe={__name:"RatingSanctions",props:{agent:{},rating:{},types:{type:Array},sanctions:{}},setup(l){const r=l,k=F().props.auth.user,m=$(()=>k.user_id===r.rating.evaluated_id),v=$(()=>k.user_id!==r.rating.evaluated_id&&k.user_id!==r.rating.evaluator_id),j=m.value?[{name:"Mes Évaluations",href:route("ratings.index",{agent_rating:r.rating.rating_id}),current:!1},{name:"Evaluation",href:"#",current:!0}]:v?[{name:"Mes validations",href:route("validations.index"),current:!1},{name:"Évaluation",href:"#",current:!0}]:[{name:"Mes Agents",href:route("agents.index"),current:!1},{name:"Évaluations",href:route("agent-ratings.index",{agent:r.agent.user_id}),current:!1},{name:"Evaluation",href:"#",current:!0}],n=V(H({sanction_type_id:x(r.types)?r.types[0].sanction_type_id:null,rating_sanction_comment:""})),M=$(()=>Q(r.sanctions)),g=V(r.sanctions.data),N=V(),T=c=>{const d=g.value.filter(a=>a.rating_sanction_id===c)[0];n.value.rating_sanction_id=c,n.value.rating_sanction_comment=d.rating_sanction_comment,n.value.sanction_type_id=d.sanction_type_id,N.value.focus()},z=()=>{n.value.rating_sanction_id?n.value.put(route("rating-sanctions.update",{rating:r.rating.rating_id,rating_sanction:n.value.rating_sanction_id})):n.value.post(route("rating-sanctions.store",{rating:r.rating.rating_id}))};return O(()=>r.sanctions,function(c){g.value=c.data,!g.value.length>0&&(c.prev_page_url?C.get(c.prev_page_url):C.get(c.first_page_url))}),(c,d)=>(i(),f(L,null,{default:s(()=>[e(o(P),{title:"Profil"}),t("div",ce,[e(I,{pages:o(j)},null,8,["pages"]),e(Z,{agent:l.agent,rating:l.rating},null,8,["agent","rating"]),e(G,{agent_id:r.agent.user_id,evaluated:m.value,rating_id:r.rating.rating_id,validator:v.value},null,8,["agent_id","evaluated","rating_id","validator"]),!m.value&&!v.value&&!l.rating.rating_is_validated?(i(),u("form",{key:0,class:"mt-8 bg-white px-4 py-5 sm:p-6 shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl md:col-span-2",onSubmit:q(z,["prevent"])},[_e,me,t("div",ge,[t("div",fe,[t("div",pe,[e(S,{for:"",required:""},{default:s(()=>[_("Nature")]),_:1}),e(o(le),{modelValue:n.value.sanction_type_id,"onUpdate:modelValue":d[0]||(d[0]=a=>n.value.sanction_type_id=a),class:"mt-2"},{default:s(()=>[t("div",ve,[e(o(re),{class:h([n.value.errors.phase_id?"ring-red-300":"ring-gray-300","w-full cursor-default rounded-md bg-white py-1.5 pl-3 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset focus:outline-none focus:ring-2 focus:ring-cyan-600 sm:text-sm sm:leading-6"])},{default:s(()=>[o(x)(l.types)?(i(),u("span",ye,p(l.types.filter(a=>a.sanction_type_id===n.value.sanction_type_id)[0].sanction_type_name),1)):(i(),u("span",he,"Aucune sanction disponible pour l'instant.")),t("span",be,[e(o(ae),{"aria-hidden":"true",class:"h-5 w-5 text-gray-400"})])]),_:1},8,["class"]),e(R,{"leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:s(()=>[o(x)(l.types)?(i(),f(o(oe),{key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:s(()=>[(i(!0),u(E,null,A(l.types,a=>(i(),f(o(ue),{key:a.sanction_type_id,value:a.sanction_type_id,as:"template"},{default:s(({active:y,selected:B})=>[t("li",{class:h([y?"bg-cyan-600 text-white":"text-gray-900","relative cursor-default select-none py-2 pl-3 pr-9"])},[t("span",{class:h([B?"font-semibold":"font-normal","block truncate"])},p(a.sanction_type_name),3),B?(i(),u("span",{key:0,class:h([y?"text-white":"text-cyan-600","absolute inset-y-0 right-0 flex items-center pr-4"])},[e(o(se),{"aria-hidden":"true",class:"h-5 w-5"})],2)):b("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})):b("",!0)]),_:1})])]),_:1},8,["modelValue"]),e(W,{message:n.value.errors.claim_type_id},null,8,["message"])]),t("div",xe,[e(S,{for:""},{default:s(()=>[_("Commentaire")]),_:1}),t("div",we,[e(ee,{ref_key:"input",ref:N,modelValue:n.value.rating_sanction_comment,"onUpdate:modelValue":d[1]||(d[1]=a=>n.value.rating_sanction_comment=a)},null,8,["modelValue"])])])])]),t("div",ke,[e(te),e(K,{disabled:l.rating.rating_is_validated,processing:n.value.processing,class:"mt-3 sm:ml-3 sm:mt-0 sm:w-auto",type:"submit"},{default:s(()=>[_("Enregistrer ")]),_:1},8,["disabled","processing"])])],40,de)):b("",!0),e(J,{title:"Sanctions Demandées"}),o(x)(l.sanctions.data)?(i(),f(X,{key:1,modelValue:U,"onUpdate:modelValue":d[2]||(d[2]=a=>U=a),pagination:M.value,search:!1},{default:s(()=>[g.value.length>0?(i(),u("table",$e,[t("thead",Ve,[t("tr",null,[e(w,{first:!0},{default:s(()=>[_("Type")]),_:1}),e(w,null,{default:s(()=>[_("Demandée par")]),_:1}),e(w,null,{default:s(()=>[_("Commentaire")]),_:1}),e(w)])]),t("tbody",Ce,[(i(!0),u(E,null,A(g.value,a=>(i(),u("tr",{key:a.rating_sanction_id},[e(D,{first:!0,class:"whitespace-pre-line"},{default:s(()=>[_(p(a.type.sanction_type_name),1)]),_:2},1024),e(D,null,{default:s(()=>[_(p(l.rating.evaluator.user_display_name),1)]),_:1}),e(D,{class:"whitespace-pre-line"},{default:s(()=>[_(p(a.rating_sanction_comment||"__"),1)]),_:2},1024),t("td",De,[!m.value&&!v.value&&!l.rating.rating_is_validated?(i(),u("div",Ne,[t("button",{class:"rounded-lg bg-cyan-600 p-2 text-white shadow-sm hover:bg-cyan-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600",type:"button",onClick:y=>T(a.rating_sanction_id)},[e(o(ne),{"aria-hidden":"true",class:"h-5 w-5"})],8,Be),t("button",{class:"rounded-lg bg-red-600 p-2 text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600",type:"button",onClick:y=>o(C).delete(c.route("rating-sanctions.destroy",{rating:l.rating.rating_id,rating_sanction:a.rating_sanction_id}))},[e(o(ie),{"aria-hidden":"true",class:"h-5 w-5"})],8,Ee)])):b("",!0)])]))),128))])])):(i(),u("div",Ae," Aucun élément trouvé."))]),_:1},8,["pagination"])):(i(),f(Y,{key:2,message:m.value?"":"Demander une sanction en utilisant la liste déroulante en haut.",title:"Aucune sanction demandée pour l'instant."},null,8,["message"]))])]),_:1}))}};export{Xe as default};
