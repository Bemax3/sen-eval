import{Q as q,b as D,r as f,T as L,w as P,o as i,d as p,e as n,f as e,u as l,Z as Q,a,c as d,g as _,n as b,t as v,p as Z,F as A,j as M,k as x,i as G,O as U}from"./app-74a7ed68.js";import{a as w,_ as I,g as J}from"./AuthenticatedLayout-c5d98272.js";import{_ as K,a as W}from"./Title-6826ba98.js";import{_ as X}from"./Breadcrumbs-9ec19463.js";import{_ as Y}from"./Separator-6eb3fcab.js";import{_ as ee}from"./SubmitButton-a4088352.js";import{_ as te}from"./InputError-82c353da.js";import{_ as ae}from"./Datatable-1f2c6bab.js";import{_ as k,a as ne,b as N}from"./EmptyState-dc589c25.js";import{_ as se}from"./TextArea-06ba8401.js";import{_ as ie}from"./FormIndications-6eabc421.js";import{_ as j}from"./InputLabel-821b8b0a.js";import{_ as oe}from"./DeleteModal-7f1b05d8.js";import{r as re}from"./ChevronUpDownIcon-7cddf03d.js";import{r as le}from"./CheckIcon-9bf2de54.js";import{r as ue}from"./PencilSquareIcon-e64d098d.js";import{r as ce}from"./TrashIcon-7903799f.js";import{N as de,H as _e,B as me,U as ge}from"./listbox-a2068e7f.js";import"./logo1637145113-c7398df9.js";import"./ExclamationTriangleIcon-a3c8ea96.js";import"./use-controllable-8a68f84c.js";const fe={class:"px-4 sm:px-6 lg:px-8"},pe=["onSubmit"],ve=a("h3",{class:"text-base font-semibold leading-6 text-gray-900"},"Donner une sanction",-1),ye=a("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[a("p",null,"Rechercher une sanction et ajouter la à la liste des sanction pour cette évaluation.")],-1),he={class:"px-4 py-6 sm:p-8"},be={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},xe={class:"col-span-full relative"},we={class:"relative"},ke={key:0,class:"block truncate"},$e={key:1,class:"block truncate"},Ve={class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2"},Ce={class:"col-span-full"},De={class:"mt-2"},Ne={class:"flex items-center justify-between gap-x-6 border-t border-gray-900/10 px-4 py-4 sm:px-8"},Be={key:0,class:"min-w-full divide-y divide-gray-300"},Ee={class:"bg-gray-50"},Se={class:"divide-y divide-gray-200 bg-white"},Ae={class:"relative whitespace-nowrap py-4 pl-3 pr-4 text-right text-sm font-medium sm:pr-6"},Me={key:0,class:"flex items-center justify-center gap-2"},Ue=["onClick"],je=["onClick"],Te={key:1,class:"text-center bg-white text-lg text-gray-600 py-4"},T="",st={__name:"RatingSanctions",props:{agent:{},rating:{},types:{type:Array},sanctions:{}},setup(r){var E;const o=r,$=q().props.auth.user,g=D(()=>$.user_id===o.rating.evaluated_id),y=D(()=>$.user_id!==o.rating.evaluated_id&&$.user_id!==o.rating.evaluator_id),z=g.value?[{name:"Mes Évaluations",href:route("ratings.index",{agent_rating:o.rating.rating_id}),current:!1},{name:"Evaluation",href:"#",current:!0}]:y?[{name:"Mes validations",href:route("validations.index"),current:!1},{name:"Évaluation",href:"#",current:!0}]:[{name:"Mes Agents",href:route("agents.index"),current:!1},{name:"Évaluations",href:route("agent-ratings.index",{agent:o.agent.user_id}),current:!1},{name:"Evaluation",href:"#",current:!0}],s=f(L({sanction_type_id:w(o.types)?o.types[0].sanction_type_id:null,rating_sanction_comment:""})),F=D(()=>J(o.sanctions)),m=f(o.sanctions.data),B=f(),V=f(!1),C=f((E=m[0])==null?void 0:E.rating_sanction_id),H=u=>{C.value=u,V.value=!0},O=u=>{const c=m.value.filter(t=>t.rating_sanction_id===u)[0];s.value.rating_sanction_id=u,s.value.rating_sanction_comment=c.rating_sanction_comment,s.value.sanction_type_id=c.sanction_type_id,B.value.focus()},R=()=>{s.value.rating_sanction_id?s.value.put(route("rating-sanctions.update",{rating:o.rating.rating_id,rating_sanction:s.value.rating_sanction_id})):s.value.post(route("rating-sanctions.store",{rating:o.rating.rating_id}))};return P(()=>o.sanctions,function(u){m.value=u.data,!m.value.length>0&&(u.prev_page_url?U.get(u.prev_page_url):U.get(u.first_page_url))}),(u,c)=>(i(),p(I,null,{default:n(()=>[e(l(Q),{title:"Sanctions"}),a("div",fe,[e(X,{pages:l(z)},null,8,["pages"]),e(K,{agent:r.agent,rating:r.rating},null,8,["agent","rating"]),e(W,{agent_id:o.agent.user_id,evaluated:g.value,rating_id:o.rating.rating_id,validator:y.value},null,8,["agent_id","evaluated","rating_id","validator"]),!g.value&&!y.value&&!r.rating.rating_is_validated?(i(),d("form",{key:0,class:"mt-8 bg-white px-4 py-5 sm:p-6 shadow-sm ring-1 ring-gray-900/5 sm:rounded-xl md:col-span-2",onSubmit:G(R,["prevent"])},[ve,ye,a("div",he,[a("div",be,[a("div",xe,[e(j,{for:"",required:""},{default:n(()=>[_("Nature")]),_:1}),e(l(me),{modelValue:s.value.sanction_type_id,"onUpdate:modelValue":c[0]||(c[0]=t=>s.value.sanction_type_id=t),class:"mt-2"},{default:n(()=>[a("div",we,[e(l(de),{class:b([s.value.errors.phase_id?"ring-red-300":"ring-gray-300","w-full cursor-default rounded-md bg-white py-1.5 pl-3 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset focus:outline-none focus:ring-2 focus:ring-cyan-700 sm:text-sm sm:leading-6"])},{default:n(()=>[l(w)(r.types)?(i(),d("span",ke,v(r.types.filter(t=>t.sanction_type_id===s.value.sanction_type_id)[0].sanction_type_name),1)):(i(),d("span",$e,"Aucune sanction disponible pour l'instant.")),a("span",Ve,[e(l(re),{"aria-hidden":"true",class:"h-5 w-5 text-gray-400"})])]),_:1},8,["class"]),e(Z,{"leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:n(()=>[l(w)(r.types)?(i(),p(l(_e),{key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:n(()=>[(i(!0),d(A,null,M(r.types,t=>(i(),p(l(ge),{key:t.sanction_type_id,value:t.sanction_type_id,as:"template"},{default:n(({active:h,selected:S})=>[a("li",{class:b([h?"bg-cyan-600  text-white":"text-gray-900","relative cursor-default select-none py-2 pl-3 pr-9"])},[a("span",{class:b([S?"font-semibold":"font-normal","block truncate"])},v(t.sanction_type_name),3),S?(i(),d("span",{key:0,class:b([h?"text-white":"text-cyan-600","absolute inset-y-0 right-0 flex items-center pr-4"])},[e(l(le),{"aria-hidden":"true",class:"h-5 w-5"})],2)):x("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})):x("",!0)]),_:1})])]),_:1},8,["modelValue"]),e(te,{message:s.value.errors.claim_type_id},null,8,["message"])]),a("div",Ce,[e(j,{for:""},{default:n(()=>[_("Commentaire")]),_:1}),a("div",De,[e(se,{ref_key:"input",ref:B,modelValue:s.value.rating_sanction_comment,"onUpdate:modelValue":c[1]||(c[1]=t=>s.value.rating_sanction_comment=t)},null,8,["modelValue"])])])])]),a("div",Ne,[e(ie),e(ee,{disabled:r.rating.rating_is_validated,processing:s.value.processing,class:"mt-3 sm:ml-3 sm:mt-0 sm:w-auto",type:"submit"},{default:n(()=>[_("Enregistrer ")]),_:1},8,["disabled","processing"])])],40,pe)):x("",!0),e(Y,{title:"Sanctions Demandées"}),l(w)(r.sanctions.data)?(i(),p(ae,{key:1,modelValue:T,"onUpdate:modelValue":c[2]||(c[2]=t=>T=t),pagination:F.value,search:!1},{default:n(()=>[m.value.length>0?(i(),d("table",Be,[a("thead",Ee,[a("tr",null,[e(k,{first:!0},{default:n(()=>[_("Type")]),_:1}),e(k,null,{default:n(()=>[_("Demandée par")]),_:1}),e(k,null,{default:n(()=>[_("Commentaire")]),_:1}),e(k)])]),a("tbody",Se,[(i(!0),d(A,null,M(m.value,t=>(i(),d("tr",{key:t.rating_sanction_id},[e(N,{first:!0,class:"whitespace-pre-line"},{default:n(()=>[_(v(t.type.sanction_type_name),1)]),_:2},1024),e(N,null,{default:n(()=>[_(v(r.rating.evaluator.user_display_name),1)]),_:1}),e(N,{class:"whitespace-pre-line"},{default:n(()=>[_(v(t.rating_sanction_comment||"__"),1)]),_:2},1024),a("td",Ae,[!g.value&&!y.value&&!r.rating.rating_is_validated?(i(),d("div",Me,[a("button",{class:"rounded-lg bg-cyan-600 p-2 text-white shadow-sm hover:bg-cyan-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600",type:"button",onClick:h=>O(t.rating_sanction_id)},[e(l(ue),{"aria-hidden":"true",class:"h-5 w-5"})],8,Ue),a("button",{class:"rounded-lg bg-red-600 p-2 text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600",type:"button",onClick:h=>H(t.rating_sanction_id)},[e(l(ce),{"aria-hidden":"true",class:"h-5 w-5"})],8,je)])):x("",!0)])]))),128))])])):(i(),d("div",Te," Aucun élément trouvé."))]),_:1},8,["pagination"])):(i(),p(ne,{key:2,message:g.value?"":"Demander une sanction en utilisant la liste déroulante en haut.",title:"Aucune sanction demandée pour l'instant."},null,8,["message"]))]),e(oe,{link:u.route("rating-sanctions.destroy",{rating:r.rating.rating_id,rating_sanction:C.value?C.value:-1}),opened:V.value,onCloseModal:c[3]||(c[3]=t=>V.value=!1)},null,8,["link","opened"])]),_:1}))}};export{st as default};
