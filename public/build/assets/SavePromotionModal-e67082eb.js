import{r as Y,w as V,o as m,d as g,e as n,u as e,T as B,f as a,a as t,c as p,t as c,P as k,g as y,n as f,p as D,F as U,j as z,k as v,i as C}from"./app-c4f187be.js";import{a as x,h as M,G as j,m as $,U as E,S as F}from"./helper-c9a85e48.js";import{_ as N}from"./InputLabel-9c315d9e.js";import{_ as G}from"./InputError-90ce686a.js";import{_ as T}from"./TextArea-d4be9570.js";import{_ as H}from"./FormIndications-abfac2c3.js";import{_ as L}from"./SubmitButton-a9fe8e59.js";import{_ as P}from"./Switch-961abc10.js";import{r as R}from"./ChevronUpDownIcon-b3e6edea.js";import{r as q}from"./CheckIcon-bcd955be.js";import{B as A,N as I,H as J,U as K}from"./listbox-6e1bf4ed.js";import"./CheckIcon-8d9f9564.js";import"./switch-6b92d620.js";import"./use-controllable-186a6d72.js";const O=t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1),Q={class:"fixed inset-0 z-10 w-screen overflow-y-auto"},W={class:"flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0"},X=["onSubmit"],Z=t("h3",{class:"text-base font-semibold leading-6 text-gray-900"},"Demander une promotion ou un avancement",-1),ee=t("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[t("p",null,"Rechercher une promotion ou un avancement et ajouter la à la liste des demandes pour cette évaluation. ")],-1),te={class:"mt-2 max-w-xl text-sm text-gray-500"},ae={class:"mt-2 max-w-xl text-sm text-gray-500"},se={class:"px-4 py-6 sm:p-8"},oe={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"},ie={class:"col-span-full"},ne={class:"mt-2"},le={class:"col-span-full relative"},re={class:"relative"},me={key:0,class:"block truncate"},de={key:1,class:"block truncate"},ce={class:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2"},ue={class:"col-span-full"},pe={class:"mt-2"},_e={class:"flex items-center justify-between gap-x-6 border-t border-gray-900/10 px-4 py-4 sm:px-8"},Ye={__name:"SavePromotionModal",props:{opened:{type:Boolean,default:!1},types:{},isValidator:{},isEvaluated:{},rating:{},promotion:{},agent:{}},emits:["closeModal"],setup(o,{emit:h}){const d=o,u=Y(!1);let s;const _=i=>{s=B(i===void 0?{evaluated_is_eligible:0,rating_promotion_comment:"",promotion_type_id:x(d.types)?d.types[0].promotion_type_id:null}:{rating_promotion_id:i.rating_promotion_id,evaluated_is_eligible:i.evaluated_is_eligible,rating_promotion_comment:i.rating_promotion_comment||"",promotion_type_id:i.promotion_type_id})},S=()=>{s.rating_promotion_id?s.put(route("rating-promotions.update",{rating:d.rating.rating_id,rating_promotion:s.rating_promotion_id}),{onSuccess:i=>{u.value=!1,h("closeModal"),_()}}):s.post(route("rating-promotions.store",{rating:d.rating.rating_id}),{onSuccess:i=>{u.value=!1,h("closeModal"),_()}})};return _(),V(()=>d.opened,i=>{u.value=i},{immediate:!0}),V(()=>d.promotion,i=>{_(i)}),(i,r)=>(m(),g(e(F),{show:u.value,as:"template"},{default:n(()=>[a(e(E),{as:"div",class:"relative z-10",onClose:r[3]||(r[3]=l=>{u.value=!1,i.$emit("closeModal")})},{default:n(()=>[a(e(M),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0","enter-to":"opacity-100",leave:"ease-in duration-200","leave-from":"opacity-100","leave-to":"opacity-0"},{default:n(()=>[O]),_:1}),t("div",Q,[t("div",W,[a(e(M),{as:"template",enter:"ease-out duration-300","enter-from":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95","enter-to":"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200","leave-from":"opacity-100 translate-y-0 sm:scale-100","leave-to":"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"},{default:n(()=>[a(e(j),{class:"relative transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-3xl sm:p-6"},{default:n(()=>[!o.isEvaluated&&!o.isValidator&&!o.rating.rating_is_validated?(m(),p("form",{key:0,onSubmit:C(S,["prevent"])},[Z,ee,t("div",te,[t("p",null,"GF: "+c(o.agent.user_gf)+" promu le "+c(k(e($)(o.agent.user_gf_prom_date).format("DD MMMM YYYY"))),1)]),t("div",ae,[t("p",null,"NR: "+c(o.agent.user_nr)+" promu le "+c(k(e($)(o.agent.user_nr_prom_date).format("DD MMMM YYYY"))),1)]),t("div",se,[t("div",oe,[t("div",ie,[t("div",ne,[a(P,{modelValue:e(s).evaluated_is_eligible,"onUpdate:modelValue":r[0]||(r[0]=l=>e(s).evaluated_is_eligible=l),desc:"L'évalué est-il éligible à cette avancement ou promotion ?",label:"Non Éligible / Éligible"},null,8,["modelValue"])])]),t("div",le,[a(N,{for:"start_date",required:""},{default:n(()=>[y("Nature")]),_:1}),a(e(A),{modelValue:e(s).promotion_type_id,"onUpdate:modelValue":r[1]||(r[1]=l=>e(s).promotion_type_id=l)},{default:n(()=>[t("div",re,[a(e(I),{class:f([e(s).errors.phase_id?"ring-red-300":"ring-gray-300","w-full cursor-default rounded-md bg-white py-1.5 pl-3 pr-10 text-left text-gray-900 shadow-sm ring-1 ring-inset focus:outline-none focus:ring-2 focus:ring-cyan-700 sm:text-sm sm:leading-6"])},{default:n(()=>[e(x)(o.types)?(m(),p("span",me,c(o.types.filter(l=>l.promotion_type_id===e(s).promotion_type_id)[0].promotion_type_name),1)):(m(),p("span",de,"Aucune promotion disponible pour l'instant.")),t("span",ce,[a(e(R),{"aria-hidden":"true",class:"h-5 w-5 text-gray-400"})])]),_:1},8,["class"]),a(D,{"leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:n(()=>[e(x)(o.types)?(m(),g(e(J),{key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none sm:text-sm"},{default:n(()=>[(m(!0),p(U,null,z(o.types,l=>(m(),g(e(K),{key:l.promotion_type_id,value:l.promotion_type_id,as:"template"},{default:n(({active:b,selected:w})=>[t("li",{class:f([b?"bg-cyan-600  text-white":"text-gray-900","relative cursor-default select-none py-2 pl-3 pr-9"])},[t("span",{class:f([w?"font-semibold":"font-normal","block truncate"])},c(l.promotion_type_name),3),w?(m(),p("span",{key:0,class:f([b?"text-white":"text-cyan-600","absolute inset-y-0 right-0 flex items-center pr-4"])},[a(e(q),{"aria-hidden":"true",class:"h-5 w-5"})],2)):v("",!0)],2)]),_:2},1032,["value"]))),128))]),_:1})):v("",!0)]),_:1})])]),_:1},8,["modelValue"]),a(G,{message:e(s).errors.promotion_type_id},null,8,["message"])]),t("div",ue,[a(N,{for:""},{default:n(()=>[y("Commentaire")]),_:1}),t("div",pe,[a(T,{ref:"input",modelValue:e(s).rating_promotion_comment,"onUpdate:modelValue":r[2]||(r[2]=l=>e(s).rating_promotion_comment=l)},null,8,["modelValue"])])])])]),t("div",_e,[a(H),a(L,{disabled:o.rating.rating_is_validated,processing:e(s).processing,class:"mt-3 sm:ml-3 sm:mt-0 sm:w-auto",type:"submit"},{default:n(()=>[y("Enregistrer ")]),_:1},8,["disabled","processing"])])],40,X)):v("",!0)]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}};export{Ye as default};
